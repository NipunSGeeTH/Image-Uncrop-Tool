<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Uncrop Image</title>
</head>
<body>
  <h2>Uncrop Image Tool</h2>

  <input type="file" id="imageInput" accept="image/*"><br><br>
  <label for="bgColor">Background color: </label>
  <input type="color" id="bgColor" value="#ffffff">
  <label>
    <input type="checkbox" id="transparentBg"> Transparent
  </label><br><br>
  <label for="expandSize">Canvas Padding (px): </label>
  <input type="number" id="expandSize" value="50" min="0"><br><br>

  <button id="processBtn">Process Image</button>
  <button id="downloadBtn">Download Image</button>
  <br><br>
  <canvas id="canvas"></canvas>

  <script>
    const imageInput = document.getElementById('imageInput');
    const bgColorInput = document.getElementById('bgColor');
    const transparentBg = document.getElementById('transparentBg');
    const expandSizeInput = document.getElementById('expandSize');
    const processBtn = document.getElementById('processBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    let img = new Image();

    imageInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        img.src = ev.target.result;
      };
      reader.readAsDataURL(file);
    });

    processBtn.addEventListener('click', () => {
      if (!img.src) {
        alert("Please select an image first.");
        return;
      }

      const padding = parseInt(expandSizeInput.value);
      const width = img.width + padding * 2;
      const height = img.height + padding * 2;

      canvas.width = width;
      canvas.height = height;

      // Clear canvas
      ctx.clearRect(0, 0, width, height);

      // Set background
      if (!transparentBg.checked) {
        ctx.fillStyle = bgColorInput.value;
        ctx.fillRect(0, 0, width, height);
      }

      // Draw image in center
      ctx.drawImage(img, padding, padding);
    });

    downloadBtn.addEventListener('click', () => {
      if (!img.src) return;
      const link = document.createElement('a');
      link.download = 'uncropped.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });
  </script>
</body>
</html>
